<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<link rel="stylesheet" href="/_assets/main.css" />

    <title>Golang和Vue整合 - ppmoon</title>
  <link rel="stylesheet" href="/_markdown_plugin_assets/highlight.js/atom-one-light.css" /></head>
  <body>
    <div class="main">
      <nav class="navigation">
        <a href="/">ppmoon</a>
      </nav>
      <article>
        <header>
          <h1 class="article-title">Golang和Vue整合</h1>
          <div class="article-info">
            <div>
              <span
                >Created At：<time datetime="1666689947446"
                  >2022-10-25 17:25</time
                ></span
              >
              <span
                >Updated At：<time datetime="1666794636092"
                  >2022-10-26 22:30</time
                ></span
              >
            </div>
            
            <div>
              Keywords: 
              <span class="keyword">vue</span>
              
              <span class="keyword">golang</span>
              
            </div>
            
          </div>
        </header>
        <div class="article-content markdown-body"><p><img src="/_resources/5a82a459be944f0d9a6cdf4e3ff619e7.png" /></p>
<p>如果我们想制作一个单体的网络应用，我们可能会采用后端渲染的方式来将前端和后端放置在一个项目中。但是所有的后端渲染方案都都不及vue和react构建的SPA的表现力和扩展力。</p>
<p>所以我们如何才能将vue这种前端框架与golang这种后端语言整合在一起，并且生成一个可执行文件呢？</p>
<h1 id="将vue嵌入到golang">将vue嵌入到golang</h1>
<h2 id="创建golang项目">创建golang项目</h2>
<div><pre class="hljs"><code>mkdir govue
<span class="hljs-built_in">cd</span> govue
go mod init govue</code></pre></div>
<p>设置一个基本的go mod并创建一个mian.go的文件</p>
<div><pre class="hljs"><code><span class="hljs-keyword">package</span> main

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>  {
    
}
</code></pre></div>
<h2 id="创建vue项目">创建vue项目</h2>
<p>在相同的目录通过Vue CLI创建vue项目.文件夹的名称叫ui或者其他你喜欢的名字。</p>
<div><pre class="hljs"><code>vue create ui</code></pre></div>
<h2 id="生成vue的静态文件">生成vue的静态文件</h2>
<div><pre class="hljs"><code>npm run build</code></pre></div>
<p>通过执行以上命令我们可以得到</p>
<h2 id="在ui目录当中创建uigo文件进行embed">在ui目录当中创建ui.go文件进行embed</h2>
<p>我们需要在ui目录当中创建一个ui.go的文件将vue生成的静态文件嵌入到golang当中。注意//go:embed all:dist当中的all在golang1.18以后才有，如果是之前的版本可以使用其他方法。</p>
<div><pre class="hljs"><code><span class="hljs-keyword">package</span> ui

<span class="hljs-keyword">import</span> <span class="hljs-string">"embed"</span>

<span class="hljs-comment">//go:embed all:dist</span>
<span class="hljs-keyword">var</span> StaticFiles embed.FS</code></pre></div>
<p>这个时候我们dist目录下的所有静态文件就全部都被嵌入到StaticFiles当中了。</p>
<h1 id="代理嵌入的静态文件">代理嵌入的静态文件</h1>
<p>在go的main函数当中设置对嵌入文件的静态代理。</p>
<div><pre class="hljs"><code><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"govue/ui"</span>
    <span class="hljs-string">"io/fs"</span>
    <span class="hljs-string">"log"</span>
    <span class="hljs-string">"net/http"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 从嵌入变量当中读取文件构建文件树</span>
    staticFS, _ := fs.Sub(ui.StaticFiles, <span class="hljs-string">"dist"</span>)
    <span class="hljs-comment">// 通过HTTP启动文件服务器</span>
    httpFS := http.FileServer(http.FS(staticFS))
    <span class="hljs-comment">// 设置路由</span>
    http.Handle(<span class="hljs-string">"/"</span>, httpFS)
    <span class="hljs-comment">// 启动http服务</span>
    log.Fatal(http.ListenAndServe(<span class="hljs-string">":80"</span>, <span class="hljs-literal">nil</span>))
}
</code></pre></div>
<p>1.从嵌入变量ui.StaticFiles构建文件树<br />
2.通过http.FileServer启动文件服务器并装在文件。<br />
3.设置路由访问文件服务。<br />
4.启动http服务。</p>
<h1 id="最后查看效果">最后查看效果</h1>
<p>访问http://localhost就可以看到可以访问成功编译的vue文件了。</p>
</div>
      </article>
    </div>
  </body>
</html>
